<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gesti贸n | Vivero Chaka</title>
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="logo.png">
  <style>
      /* Estilos adicionales espec铆ficos para la app */
      .no-print {
          display: block;
      }

      @media print {
          .no-print, .floating-actions, .app-nav, .app-footer, .header-actions {
              display: none !important;
          }

          .app-main {
              padding: 0 !important;
              margin: 0 !important;
          }

          .content-body {
              padding: 0 !important;
              background: white !important;
              box-shadow: none !important;
          }
      }

      /* Modal info */
      .modal-info {
          background: linear-gradient(135deg, rgba(46, 125, 50, 0.08), rgba(139, 195, 74, 0.05));
          padding: 16px 20px;
          border-radius: 12px;
          margin-bottom: 20px;
          font-size: 0.95rem;
          color: var(--text-color);
          display: flex;
          align-items: flex-start;
          gap: 12px;
          border-left: 4px solid var(--primary-color);
          box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }

      .modal-info i {
          color: var(--primary-color);
          font-size: 1.2rem;
          margin-top: 2px;
      }

      /* Content body */
      .content-body {
          background-color: var(--bg-card);
          padding: 2rem;
          border-radius: 16px;
          box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
          margin-top: 1.5rem;
          border: 1px solid rgba(46, 125, 50, 0.1);
      }

      /* Selection info */
      .selection-info {
          display: flex;
          align-items: center;
          gap: 20px;
          font-size: 0.95rem;
          color: var(--text-color);
          padding: 12px 16px;
          background: rgba(46, 125, 50, 0.05);
          border-radius: 10px;
          margin: 15px 0;
      }

      .selection-info span {
          font-weight: 600;
          color: var(--primary-color);
      }

      /* Modal actions */
      .modal-actions {
          display: flex;
          gap: 12px;
          justify-content: flex-end;
          padding-top: 20px;
          border-top: 1px solid rgba(0, 0, 0, 0.08);
          margin-top: 20px;
      }

      /* Print logo */
      .print-logo {
          width: 120px;
          height: 120px;
          margin-right: 25px;
          flex-shrink: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: white;
          border-radius: 12px;
          padding: 10px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }

      .print-logo-img {
          max-width: 100%;
          max-height: 100%;
          object-fit: contain;
      }

      /* Status action buttons */
      .status-actions {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
      }

      .action-btn.confirm {
          background: linear-gradient(135deg, rgba(40, 167, 69, 0.15), rgba(40, 167, 69, 0.1));
          color: #28a745;
          border: 1px solid rgba(40, 167, 69, 0.3);
          transition: all 0.2s;
      }

      .action-btn.confirm:hover {
          background: linear-gradient(135deg, rgba(40, 167, 69, 0.25), rgba(40, 167, 69, 0.2));
          transform: translateY(-1px);
          box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2);
      }

      .action-btn.cancel {
          background: linear-gradient(135deg, rgba(220, 53, 69, 0.15), rgba(220, 53, 69, 0.1));
          color: #dc3545;
          border: 1px solid rgba(220, 53, 69, 0.3);
          transition: all 0.2s;
      }

      .action-btn.cancel:hover {
          background: linear-gradient(135deg, rgba(220, 53, 69, 0.25), rgba(220, 53, 69, 0.2));
          transform: translateY(-1px);
          box-shadow: 0 4px 8px rgba(220, 53, 69, 0.2);
      }

      /* Floating action buttons */
      .floating-actions {
          position: fixed;
          bottom: 30px;
          right: 30px;
          z-index: 1000;
          display: flex;
          flex-direction: column;
          gap: 15px;
      }

      .floating-btn {
          width: 60px;
          height: 60px;
          border-radius: 50%;
          background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
          color: white;
          border: none;
          box-shadow: 0 6px 20px rgba(46, 125, 50, 0.3);
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.4rem;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          position: relative;
          overflow: hidden;
      }

      .floating-btn::after {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          width: 5px;
          height: 5px;
          background: rgba(255, 255, 255, 0.5);
          opacity: 0;
          border-radius: 100%;
          transform: scale(1, 1) translate(-50%);
          transform-origin: 50% 50%;
      }

      .floating-btn:focus:not(:active)::after {
          animation: ripple 1s ease-out;
      }

      .floating-btn:hover {
          transform: scale(1.1) translateY(-3px);
          box-shadow: 0 10px 25px rgba(46, 125, 50, 0.4);
      }

      .floating-btn:active {
          transform: scale(0.95);
      }

      .floating-btn.quick-add {
          background: linear-gradient(135deg, #FF9800, #FFB74D);
      }

      .floating-btn.quick-print {
          background: linear-gradient(135deg, #2196F3, #64B5F6);
      }

      .floating-btn.quick-search {
          background: linear-gradient(135deg, #9C27B0, #BA68C8);
      }

      /* Required fields */
      .required-field {
          position: relative;
      }

      .required-field::after {
          content: "*";
          color: #f44336;
          margin-left: 4px;
          font-weight: bold;
      }

      /* Validation feedback */
      .valid-feedback {
          color: var(--success-color);
          font-size: 0.9rem;
          margin-top: 6px;
          display: flex;
          align-items: center;
          gap: 6px;
          animation: fadeIn 0.3s ease;
      }

      .invalid-feedback {
          color: var(--danger-color);
          font-size: 0.9rem;
          margin-top: 6px;
          display: flex;
          align-items: center;
          gap: 6px;
          animation: fadeIn 0.3s ease;
      }

      /* Large modals */
      .modal-content.large {
          max-width: 95%;
          max-height: 95vh;
          width: 1200px;
      }

      /* Skeleton loading */
      .skeleton {
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: loading 1.5s infinite ease-in-out;
          border-radius: 6px;
      }

      @keyframes loading {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
      }

      @keyframes ripple {
          0% {
              transform: scale(0, 0);
              opacity: 0.5;
          }
          20% {
              transform: scale(25, 25);
              opacity: 0.3;
          }
          100% {
              opacity: 0;
              transform: scale(40, 40);
          }
      }

      /* Responsive table improvements */
      .responsive-table {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          border-radius: 12px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.05);
          margin: 20px 0;
      }

      .responsive-table table {
          min-width: 1200px;
          margin: 0;
      }

      /* Tooltips */
      [data-tooltip] {
          position: relative;
          cursor: help;
      }

      [data-tooltip]:hover::before {
          content: attr(data-tooltip);
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          background: rgba(51, 51, 51, 0.95);
          color: white;
          padding: 10px 14px;
          border-radius: 8px;
          font-size: 13px;
          white-space: nowrap;
          z-index: 1000;
          margin-bottom: 8px;
          pointer-events: none;
          animation: fadeIn 0.2s ease;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          max-width: 250px;
          word-wrap: break-word;
          white-space: normal;
          text-align: center;
          line-height: 1.4;
      }

      [data-tooltip]:hover::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 6px solid transparent;
          border-top-color: rgba(51, 51, 51, 0.95);
          margin-bottom: 2px;
      }

      /* Empty states */
      .empty-state {
          text-align: center;
          padding: 60px 20px;
          color: var(--text-light);
          animation: fadeIn 0.5s ease;
      }

      .empty-state i {
          font-size: 4rem;
          color: #e0e0e0;
          margin-bottom: 20px;
          display: block;
          opacity: 0.7;
      }

      .empty-state h3 {
          font-size: 1.5rem;
          margin-bottom: 10px;
          color: var(--text-light);
      }

      .empty-state p {
          font-size: 1rem;
          max-width: 400px;
          margin: 0 auto 20px;
          line-height: 1.6;
      }

      /* Loading overlay */
      .loading-overlay {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(255, 255, 255, 0.9);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          z-index: 100;
          border-radius: 12px;
          animation: fadeIn 0.3s ease;
      }

      .loading-spinner {
          width: 50px;
          height: 50px;
          border: 4px solid #f3f3f3;
          border-top: 4px solid var(--primary-color);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-bottom: 15px;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      /* Quick stats */
      .quick-stats {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 15px;
          margin: 20px 0;
      }

      .quick-stat {
          background: white;
          padding: 15px;
          border-radius: 10px;
          text-align: center;
          box-shadow: 0 2px 8px rgba(0,0,0,0.05);
          transition: transform 0.2s;
      }

      .quick-stat:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }

      .quick-stat-value {
          font-size: 2rem;
          font-weight: 700;
          color: var(--primary-color);
          margin-bottom: 5px;
      }

      .quick-stat-label {
          font-size: 0.9rem;
          color: var(--text-light);
      }

      /* Dark mode adjustments */
      @media (prefers-color-scheme: dark) {
          .content-body {
              background-color: var(--bg-card);
              border-color: rgba(255, 255, 255, 0.1);
          }

          .modal-info {
              background: linear-gradient(135deg, rgba(46, 125, 50, 0.2), rgba(139, 195, 74, 0.1));
          }

          .selection-info {
              background: rgba(46, 125, 50, 0.15);
          }

          .skeleton {
              background: linear-gradient(90deg, #3d3d3d 25%, #4d4d4d 50%, #3d3d3d 75%);
          }

          .loading-overlay {
              background: rgba(45, 45, 45, 0.9);
          }

          .loading-spinner {
              border-color: #555;
              border-top-color: var(--primary-color);
          }

          .quick-stat {
              background: var(--bg-card);
          }
      }

      /* Accessibility */
      @media (prefers-reduced-motion: reduce) {
          * {
              animation-duration: 0.01ms !important;
              animation-iteration-count: 1 !important;
              transition-duration: 0.01ms !important;
          }
      }

      /* Touch optimizations */
      @media (hover: none) and (pointer: coarse) {
          .action-btn, .btn-icon {
              min-width: 44px;
              min-height: 44px;
              padding: 10px;
          }

          .floating-btn {
              width: 56px;
              height: 56px;
          }

          [data-tooltip]:hover::before,
          [data-tooltip]:hover::after {
              display: none;
          }

          .responsive-table {
              -webkit-overflow-scrolling: touch;
          }
      }

      /* Print optimizations */
      @page {
          margin: 1.5cm;
      }

      @media print {
          body {
              background: white !important;
              color: black !important;
          }

          a {
              color: black !important;
              text-decoration: none !important;
          }

          .print-break {
              page-break-inside: avoid;
          }

          .print-hide {
              display: none !important;
          }

          .print-only {
              display: block !important;
          }
      }
  </style>
</head>
<body>
<div class="app-container">
  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <div class="logo">
        <img src="logo.png" alt="Vivero Chaka"
             style="height: 45px; width: 45px; object-fit: contain; border-radius: 8px;"
             onerror="this.onerror=null; this.src='logo.jpg'; this.alt='Logo Vivero Chaka'">
        <h2><span>MXICO PRIMERO S DE S.S.</span></h2>
      </div>
      <h1 id="pageTitle">Sistema de Gesti贸n Integral</h1>
    </div>
    <div class="header-right">
      <div class="user-info">
        <div class="user-avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="user-details">
          <h3 id="userName">Usuario</h3>
          <p id="userRole">Administrador</p>
        </div>
      </div>
      <button class="logout-btn" id="logoutBtn" data-tooltip="Cerrar sesi贸n">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="app-nav">
    <ul>
      <li class="nav-item" data-module="semillas">
        <a href="#semillas">
          <i class="fas fa-seedling"></i>
          <span>Semillas</span>
        </a>
      </li>
      <li class="nav-item" data-module="plantas">
        <a href="#plantas">
          <i class="fas fa-leaf"></i>
          <span>Plantas</span>
          <span class="badge dev">Dev</span>
        </a>
      </li>
      <li class="nav-item" data-module="fertilizantes">
        <a href="#fertilizantes">
          <i class="fas fa-flask"></i>
          <span>Fertilizantes</span>
          <span class="badge dev">Dev</span>
        </a>
      </li>
      <li class="nav-item" data-module="cotizaciones">
        <a href="#cotizaciones">
          <i class="fas fa-file-invoice-dollar"></i>
          <span>Cotizaciones</span>
        </a>
      </li>
      <li class="nav-item" data-module="cotizaciones_hechas">
        <a href="#cotizaciones_hechas">
          <i class="fas fa-history"></i>
          <span>Historial</span>
        </a>
      </li>
      <li class="nav-item" data-module="estadisticas">
        <a href="#estadisticas">
          <i class="fas fa-chart-line"></i>
          <span>Estad铆sticas</span>
          <span class="badge dev">Dev</span>
        </a>
      </li>
      <li class="nav-item" data-module="basedatos">
        <a href="#basedatos">
          <i class="fas fa-database"></i>
          <span>Base de Datos</span>
          <span class="badge dev">Dev</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="app-main">
    <div id="mainContent">
      <!-- El contenido se cargar谩 din谩micamente aqu铆 -->
      <div class="loading-overlay" id="initialLoading" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Cargando sistema...</p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="app-footer">
    <p>漏 2026 Vivero Chaka. Sistema de Gesti贸n Integral v2.0.0</p>
    <p style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8;">
      <span id="connectionStatus" class="badge success">
        <i class="fas fa-wifi"></i> Conectado
      </span>
      <span style="margin: 0 10px;">|</span>
      ltima actualizaci贸n: <span id="lastUpdate"></span>
    </p>
  </footer>
</div>

<!-- Botones flotantes para acciones r谩pidas -->
<div class="floating-actions no-print">
  <button class="floating-btn quick-add" id="quickAddBtn" data-tooltip="Agregar r谩pido">
    <i class="fas fa-plus"></i>
  </button>
  <button class="floating-btn quick-print" id="quickPrintBtn" data-tooltip="Imprimir r谩pido">
    <i class="fas fa-print"></i>
  </button>
</div>

<!-- Notification Container -->
<div id="notificationContainer"></div>


<!-- Scripts - ORDEN CORRECTO -->
<script src="js/semillas.js"></script>
<script src="js/cotizaciones.js"></script>
<script src="js/cotizaciones_hechas.js"></script>
<script src="js/app.js"></script>

<script>
  // Script para botones flotantes y funcionalidades globales
  document.addEventListener('DOMContentLoaded', function() {
    console.log(' Sistema Vivero Chaka inicializado');

    // Configurar fecha de 煤ltima actualizaci贸n
    const lastUpdate = document.getElementById('lastUpdate');
    if (lastUpdate) {
      lastUpdate.textContent = new Date().toLocaleDateString('es-ES', {
        day: 'numeric',
        month: 'long',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Configurar botones flotantes
    const quickAddBtn = document.getElementById('quickAddBtn');
    const quickPrintBtn = document.getElementById('quickPrintBtn');
    const quickSearchBtn = document.getElementById('quickSearchBtn');
    const globalSearchModal = document.getElementById('globalSearchModal');
    const globalSearchInput = document.getElementById('globalSearchInput');
    const globalSearchResults = document.getElementById('globalSearchResults');

    // Bot贸n de b煤squeda global
    if (quickSearchBtn && globalSearchModal) {
      quickSearchBtn.addEventListener('click', function() {
        globalSearchModal.style.display = 'flex';
        setTimeout(() => globalSearchModal.classList.add('show'), 10);
        setTimeout(() => globalSearchInput.focus(), 50);
      });

      // Cerrar modal
      globalSearchModal.querySelector('.modal-close').addEventListener('click', function() {
        closeGlobalSearch();
      });

      globalSearchModal.addEventListener('click', function(e) {
        if (e.target === globalSearchModal) {
          closeGlobalSearch();
        }
      });

      // B煤squeda en tiempo real
      let searchTimeout;
      globalSearchInput.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          performGlobalSearch(e.target.value);
        }, 300);
      });

      // Atajo de teclado: Ctrl+K para b煤squeda global
      document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          quickSearchBtn.click();
        }
        if (e.key === 'Escape' && globalSearchModal.style.display === 'flex') {
          closeGlobalSearch();
        }
      });
    }

    function closeGlobalSearch() {
      globalSearchModal.classList.remove('show');
      setTimeout(() => {
        globalSearchModal.style.display = 'none';
        globalSearchInput.value = '';
        globalSearchResults.innerHTML = '';
      }, 300);
    }

    async function performGlobalSearch(query) {
      if (!query || query.length < 2) {
        globalSearchResults.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-search"></i>
            <p>Escribe al menos 2 caracteres para buscar</p>
          </div>
        `;
        return;
      }

      globalSearchResults.innerHTML = `
        <div style="text-align: center; padding: 30px;">
          <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--primary-color);"></i>
          <p style="margin-top: 10px; color: var(--text-light);">Buscando...</p>
        </div>
      `;

      // Simular b煤squeda (en producci贸n esto ser铆a una llamada a API)
      setTimeout(() => {
        const results = [
          { type: 'semilla', name: 'Cedro rojo', module: 'semillas', id: 1 },
          { type: 'cotizacion', name: 'Cotizaci贸n MP-123', module: 'cotizaciones_hechas', id: 'MP-123' },
          { type: 'cliente', name: 'Agricultura S.A.', module: 'cotizaciones', id: null }
        ];

        if (results.length === 0) {
          globalSearchResults.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-search"></i>
              <p>No se encontraron resultados para "${query}"</p>
            </div>
          `;
          return;
        }

        const resultsHTML = results.map(result => `
          <div class="search-result-item" data-module="${result.module}" data-id="${result.id}">
            <div class="result-icon">
              <i class="fas fa-${result.type === 'semilla' ? 'seedling' : result.type === 'cotizacion' ? 'file-invoice-dollar' : 'user'}"></i>
            </div>
            <div class="result-content">
              <h4>${result.name}</h4>
              <p>${result.type === 'semilla' ? 'Semilla' : result.type === 'cotizacion' ? 'Cotizaci贸n' : 'Cliente'}</p>
            </div>
            <div class="result-action">
              <i class="fas fa-arrow-right"></i>
            </div>
          </div>
        `).join('');

        globalSearchResults.innerHTML = resultsHTML;

        // Agregar eventos a los resultados
        globalSearchResults.querySelectorAll('.search-result-item').forEach(item => {
          item.addEventListener('click', function() {
            const module = this.getAttribute('data-module');
            const id = this.getAttribute('data-id');
            closeGlobalSearch();

            // Navegar al m贸dulo correspondiente
            if (window.app && window.app.navigateToModule) {
              window.app.navigateToModule(module);

              // Si hay un ID espec铆fico, mostrar detalles despu茅s de cargar
              setTimeout(() => {
                if (id && window.app.currentModule) {
                  if (module === 'semillas' && window.app.currentModule.openSeedModal) {
                    window.app.currentModule.openSeedModal(id);
                  } else if (module === 'cotizaciones_hechas' && window.app.currentModule.viewQuotation) {
                    // Buscar la cotizaci贸n por ID
                    const quotations = JSON.parse(localStorage.getItem('mexicoprimero_cotizaciones') || '[]');
                    const quote = quotations.find(q => q.id === id);
                    if (quote) {
                      window.app.currentModule.viewQuotation(quote);
                    }
                  }
                }
              }, 500);
            }
          });
        });
      }, 500);
    }

    // Bot贸n de agregar r谩pido
    if (quickAddBtn) {
      quickAddBtn.addEventListener('click', function() {
        const currentModule = window.location.hash.substring(1) || 'semillas';

        if (window.app && window.app.currentModule) {
          switch(currentModule) {
            case 'semillas':
              if (window.app.currentModule.openSeedModal) {
                window.app.currentModule.openSeedModal();
              }
              break;
            case 'cotizaciones':
              if (window.app.currentModule.openProductsModal) {
                window.app.currentModule.openProductsModal();
              }
              break;
            case 'cotizaciones_hechas':
              // Crear nueva cotizaci贸n desde historial
              window.app.navigateToModule('cotizaciones');
              break;
            default:
              window.app.showNotification('Acci贸n no disponible en este m贸dulo', 'info');
          }
        }
      });
    }

    // Bot贸n de imprimir r谩pido
    if (quickPrintBtn) {
      quickPrintBtn.addEventListener('click', function() {
        const currentModule = window.location.hash.substring(1);

        if (window.app && window.app.currentModule) {
          switch(currentModule) {
            case 'cotizaciones':
              const previewBtn = document.getElementById('previewPrintBtn');
              if (previewBtn) {
                previewBtn.click();
              } else {
                window.app.showNotification('Completa la cotizaci贸n primero', 'info');
              }
              break;
            case 'cotizaciones_hechas':
              window.app.showNotification('Selecciona una cotizaci贸n para imprimir', 'info');
              break;
            case 'semillas':
              // Imprimir inventario de semillas
              const printBtn = document.getElementById('exportSeedsBtn');
              if (printBtn) {
                window.app.showNotification('Exportando inventario...', 'info');
                // Simular exportaci贸n
                setTimeout(() => {
                  window.app.showNotification('Inventario listo para imprimir', 'success');
                }, 1000);
              }
              break;
            default:
              window.app.showNotification('Impresi贸n no disponible en este m贸dulo', 'info');
          }
        }
      });
    }

    // Monitorear conexi贸n
    function updateConnectionStatus() {
      const statusElement = document.getElementById('connectionStatus');
      if (statusElement) {
        const isOnline = navigator.onLine;
        if (isOnline) {
          statusElement.className = 'badge success';
          statusElement.innerHTML = '<i class="fas fa-wifi"></i> Conectado';
        } else {
          statusElement.className = 'badge warning';
          statusElement.innerHTML = '<i class="fas fa-wifi-slash"></i> Sin conexi贸n';
        }
      }
    }

    window.addEventListener('online', updateConnectionStatus);
    window.addEventListener('offline', updateConnectionStatus);
    updateConnectionStatus();

    // Atajos de teclado globales
    document.addEventListener('keydown', function(e) {
      // Ctrl+S para guardar
      if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        const saveBtn = document.getElementById('saveQuoteBtn') ||
          document.getElementById('modalSave') ||
          document.getElementById('saveSeedBtn');
        if (saveBtn && !saveBtn.disabled) {
          saveBtn.click();
        }
      }

      // Ctrl+P para imprimir
      if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
        e.preventDefault();
        quickPrintBtn.click();
      }

      // Escape para cerrar modales
      if (e.key === 'Escape') {
        const openModal = document.querySelector('.modal.show');
        if (openModal) {
          const closeBtn = openModal.querySelector('.modal-close');
          if (closeBtn) closeBtn.click();
        }
      }
    });

    // Estilos para resultados de b煤squeda
    const style = document.createElement('style');
    style.textContent = `
      .search-result-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
        transition: all 0.2s;
        border-radius: 8px;
        margin-bottom: 8px;
      }

      .search-result-item:hover {
        background-color: rgba(46, 125, 50, 0.05);
        transform: translateX(5px);
      }

      .search-result-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .result-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }

      .result-content {
        flex: 1;
      }

      .result-content h4 {
        margin: 0 0 5px 0;
        font-size: 1rem;
        color: var(--text-color);
      }

      .result-content p {
        margin: 0;
        font-size: 0.85rem;
        color: var(--text-light);
      }

      .result-action {
        color: var(--text-light);
        font-size: 1.1rem;
        opacity: 0.7;
        transition: opacity 0.2s;
      }

      .search-result-item:hover .result-action {
        opacity: 1;
        color: var(--primary-color);
      }
    `;
    document.head.appendChild(style);
  });
</script>
</body>

</html>
